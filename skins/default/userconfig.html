<load target="../../../member/skins/default/css/member.css" />
<load target="css/default.css" />
<include target="../../../member/skins/default/common_header.html" cond="!$force_use_otp || ($force_use_otp && $user_config->use === 'Y')" />
<div class="xm">
    <div cond="$XE_VALIDATOR_MESSAGE && $XE_VALIDATOR_ID == 'modules/googleotp/tpl/otp/otpconfig/1'" class="message {$XE_VALIDATOR_MESSAGE_TYPE}">
        <p>{$XE_VALIDATOR_MESSAGE}</p>
    </div>
    <div class="message error" cond="$force_use_otp && $user_config->use !== 'Y'">
        <p>사이트 정책으로 활동하시기 전 반드시 2차 인증을 사용 설정하셔야 합니다.</p>
    </div>
    <form action="./" method="post" class="form-horizontal" id="fo_otpconfig">
        <input type="hidden" name="module" value="googleotp" />
        <input type="hidden" name="act" value="procGoogleotpUserConfig" />
        <input type="hidden" name="xe_validator_id" value="modules/googleotp/tpl/otp/otpconfig/1" />
        <input type="hidden" name="error_return_url" value="{getRequestUriByServerEnviroment()}" />
        <input type="hidden" name="member_srl" value="{$member_srl}">
        <section class="section">
            <h1>로그인 2차 인증 설정</h1>
            <div class="control-group">
                <label class="control-label">로그인시 2차 인증 사용하기</label>
                <div class="controls">
                    <label class="inline">
                        <input type="radio" name="use" id="use_tfa" value="Y" checked="checked"|cond="$user_config->use == 'Y' || $force_use_otp" /> 사용함
                    </label>
                    <label class="inline">
                        <input type="radio" name="use" id="no_use_tfa" value="N" checked="checked"|cond="$user_config->use != 'Y' && !$force_use_otp" disabled="disabled"|cond="$force_use_otp" /> 사용하지 않음
                    </label>
                    <p class="help-block" cond="$force_use_otp">사이트 정책으로 2차 인증 비활성화가 불가능합니다.</p>
                    <p class="help-block" cond="!$force_use_otp">로그인시에 2차 인증을 통해 보안을 강화합니다.</p>
                </div>
            </div>
            <div id="tfa_enabled" style="display:none"|cond="$user_config->use != 'Y' && !$force_use_otp">
                <hr><br>
                <div class="control-group">
                    <label class="control-label">2차 인증 방식</label>
                    <div class="controls">
                        <!--@if(in_array('otp', $googleotp_config->allow_issue_type))-->
                        <label class="inline">
                            <input type="radio" name="issue_type" id="auth_otp" value="otp" checked="checked"|cond="$user_config->issue_type == 'otp'" /> Google OTP
                        </label>
                        <!--@endif-->

                        <!--@if(in_array('email', $googleotp_config->allow_issue_type))-->
                        <label class="inline">
                            <input type="radio" name="issue_type" id="auth_email" value="email" checked="checked"|cond="$user_config->issue_type == 'email'" /> 이메일 인증
                        </label>
                        <!--@endif-->

                        <!--@if(in_array('sms', $googleotp_config->allow_issue_type))-->
                        <label class="inline">
                            <input type="radio" name="issue_type" id="auth_sms" value="sms" checked="checked"|cond="$user_config->issue_type == 'sms'" /> SMS 인증
                        </label>
                        <!--@endif-->
                        <p class="help-block">인증 방식을 설정해주세요.</p>
                        <p id="google_otp_help-block" style="display:none"|cond="$user_config->issue_type != 'otp'">주의 : 하단의 QR코드를 휴대폰에서 인식하여 Google OTP에 사이트를 추가해주세요.</p>
                        <p id="email_auth_help-block" style="display:none"|cond="$user_config->issue_type != 'email'">주의 : 다음 로그인부터 해당 이메일({$user_mail})로 인증 메일이 발송됩니다.</p>
                        <p id="sms_auth_help-block" style="display:none"|cond="$user_config->issue_type != 'sms'">주의 : 다음 로그인부터 해당 전화번호({$user_phone})로 인증 메세지가 발송됩니다.</p>
                    </div>
                </div>
                <div class="control-group" id="google_otp_qr" style="display:none"|cond="$user_config->issue_type != 'otp'">
                    <label class="control-label">Google OTP QR코드</label>
                    <div class="controls">
                        <img src="{$user_config->qrcode}" />
                        <p class="help-block">Google OTP에 등록할 때 사용할 QR코드입니다 외부로 유출되지 않도록 아이디 및 절대 이 QR코드를 저장하지 마세요.</p>
                    </div>
                </div>
                <div class="control-group" id="google_otp_input" style="display:none"|cond="$user_config->issue_type != 'otp'">
                    <label class="control-label">확인용 인증코드</label>
                    <div class="controls">
                        <input type="number" name="test_auth_key" value="" />
                        <p class="help-block">위 QR코드를 사용해 Google OTP를 등록한 뒤 표시되는 인증코드를 입력해주세요.</p>
                    </div>
                </div>
            </div>
        </section>
        <div class="clearfix btnArea">
            <div class="pull-right">
                <button class="btn btn-primary" type="submit">설정 저장</button>
            </div>
        </div>
    </form>
</div>
<script>
$('#use_tfa').click(function(){
    $('#tfa_enabled').show();
});
$('#no_use_tfa').click(function(){
    $('#tfa_enabled').hide();
});

$('#auth_otp').click(function(){
    $('#google_otp_qr').show();
    $('#google_otp_input').show();
    $('#google_otp_help-block').show();
    $('#email_auth_help-block').hide();
    $('#sms_auth_help-block').hide();
});
$('#auth_email').click(function(){
    $('#google_otp_qr').hide();
    $('#google_otp_input').hide();
    $('#google_otp_help-block').hide();
    $('#email_auth_help-block').show();
    $('#sms_auth_help-block').hide();
});
$('#auth_sms').click(function(){
    $('#google_otp_qr').hide();
    $('#google_otp_input').hide();
    $('#google_otp_help-block').hide();
    $('#email_auth_help-block').hide();
    $('#sms_auth_help-block').show();
});
</script>
<include target="../../../member/skins/default/common_footer.html" cond="!$force_use_otp || ($force_use_otp && $user_config->use == 'Y')" />
